<comment>
	<link href="/Public/bootstrap/css/bootstrap.css" rel="text/css"/>
</comment>
<layout name=":InfoSiteFrame">
	$title='添加条目～';
</layout>
<BrowserLib>
	UI
	jslib-gt/enhanced_link.js
	jslib-gt/formhandler.js
	scripts/upload-inputgen.js
	bootstrap/bootstrap-datepicker.js
</BrowserLib>
<AddHeader>
	<style type="text/css">
		#PropertyTable {
			width: 100%;
		}

		#PropertyTable td {
			white-space: nowrap;
		}

		.container {
			min-width: 700px !important;
		}

		#field_collect .disabled {
			color: #ccc;
		}
	</style>
	<script type="text/javascript" wrap="ready">
		var field_define = {__ITEM_FIELDS__};
		var this_doc = {$data: json};
		var field_has = [];

		var frmMain = $('#PropertyForm');
		var $collect = $('#field_collect');
		var $PropertyTable = $('#PropertyTable').find('tbody');

		for(var id in field_define){
			var a = $('<a/>').text(field_define[id]['name']);
			if(field_has.indexOf(id) !== -1){
				a.addClass('disabled');
			}
			var li = $('<li/>').attr('id', 'field_' + id).data(field_define[id]).appendTo($collect).append(a);

			console.log(id + '\t => ', this_doc[id]);
			if(this_doc.hasOwnProperty(id)){
				var value = this_doc[id];
				var define = field_define[id];
				var fn = type_widget(define.type);
				var $obj = fn(define['id'], define['subtype'], value, define['text']);
				
				$PropertyTable.append(form_item(define.name, $obj));

				a.addClass('disabled');
			}
		}
		value = define = fn = $obj = null;

		console.log(this_doc);

		$collect.on('click', 'a:not(.disabled)', function (){
			var $this = $(this).addClass('disabled');
			var data = $this.parent().data();
			var fn = type_widget(data.type);
			var $obj = fn(data['id'], data['subtype'], data['value'], data['text']);
			$PropertyTable.append(form_item(data.name, $obj));
		});

		$('#btnSubmit').click(function (){
			frmMain.attr('action', '<url method="submit"/>');
			$.confirm('确定要保存吗？',function (){
				frmMain.ajaxSubmit();
			}, "取消").title('请谨慎操作。');
			//frmMain.submit();
			return false;
		});
	</script>
</AddHeader>
<div id="MainContainer" class="container">
	<div class="row">
		<h2 class="col-sm-6">编辑条目
			<small>谁都会编辑的动漫百科</small>
		</h2>
	</div>
	<div class="row">
		<div class="col-xs-3">
			<div class="panel panel-default">
				<div class="panel-heading">
					字段们
				</div>
				<div class="panel-body">
					<ul id="field_collect">

					</ul>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					编辑须知
				</div>
				<div class="panel-body">
					请确认xxx！<br/>
					详情参考
					<a>链接</a>
					<br/>
					返回条目
				</div>
			</div>
		</div>
		<div id="property" class="col-xs-9">
			<form id="PropertyForm" class="form-horizontal" method="post">
				<div class="panel panel-primary">
					<div class="panel-heading">基本信息</div>
					<table id="PropertyTable" class="table table-hover panel-body">
						<tbody>

						</tbody>
					</table>
					<div class="panel-footer">
						<a id="btnSubmit" class="btn-warning btn">确认提交</a>
						<input type="submit" class="btn-primary btn" value="预览">
					</div>
				</div>
			</form>
		</div>
	</div>
	<div class="row"></div>
</div>
